version: 1

honeycomb_team: brooke # repo scoped OR could be near the env

deployment_protection_rules:
  stage: # github env name
    queries:
      - honeycomb_environment: prod # honeycomb env to query against
        spec: &queryspec '{
            "time_range": 1800,
            "calculations": [
              {
                  "op": "COUNT"
              }
            ],
            "filters": [
              {
                  "column": "status_code",
                  "op": "=",
                  "value": "500"
              }
            ],
            "filter_combination": "AND"
          }'
        threshold:
          operator: '>'
          value: 3
  production:
    queries:
      - honeycomb_environment: prod
        spec: *queryspec
        threshold:
          operator: '>'
          value: 1